<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Cargador con recorte redondeado</title>

    <link rel="icon" href="imagenes/imagen4.png" type="image/png">

    <style>
        :root {
            --radius: 16px;
        }

        body {
            font-family: sans-serif;
            padding: 15px;
            background: #f3f3f8;
            margin: 0;
        }

        h2 {
            font-size: 1.2rem;
            text-align: center;
        }

        /* --- CONTENEDORES RESPONSIVOS --- */
        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: stretch;
            margin-bottom: 20px;
        }

        /* Dropzone full width en móvil */
        .dropzone {
            border: 2px dashed #aaa;
            padding: 25px;
            border-radius: 14px;
            cursor: pointer;
            background: #fff;
            text-align: center;
            font-size: 1rem;
        }

        label {
            font-size: .9rem;
        }

        input[type=range] {
            width: 100%;
        }

        button {
            padding: 10px;
            font-size: 1rem;
            border-radius: 10px;
            border: 0;
            background: #0066ff;
            color: white;
            cursor: pointer;
        }

        #circle {
            background: #333;
        }

        /* --- GALERÍA RESPONSIVA --- */
        .gallery {
            margin-top: 10px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
        }

        /* Las tarjetas se adaptan al ancho disponible */
        .card {
            width: 100%;
            aspect-ratio: 1;
            border-radius: var(--radius);
            overflow: hidden;
            position: relative;
            background: #ddd;
        }

            .card.clip-circle {
                border-radius: 50%;
            }

        img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .download {
            position: absolute;
            top: 6px;
            right: 6px;
            background: rgba(0,0,0,0.6);
            color: white;
            border: 0;
            padding: 5px 7px;
            border-radius: 8px;
            cursor: pointer;
            font-size: .9rem;
        }

        /* --- Mejoras para pantallas pequeñas --- */
        @media (max-width: 480px) {
            h2 {
                font-size: 1.1rem;
            }

            .dropzone {
                font-size: .95rem;
            }

            button {
                font-size: .9rem;
                padding: 9px;
            }
        }
    </style>
</head>
<body>

<h2>Subir imágenes y recortarlas</h2>
<div class="controls" style="display:flex; gap:20px; align-items:center; margin-bottom:15px;">
  <div class="dropzone" id="drop">Click o arrastra imágenes aquí</div>
  <label>Radio: <input id="rad" type="range" min="0" max="150" value="16"></label>
  <button id="circle">Círculo</button>
</div>

<div class="gallery" id="gal"></div>

<script>
let circle = false;

const drop = document.getElementById('drop');
const gal = document.getElementById('gal');
const rad = document.getElementById('rad');
const btnCircle = document.getElementById('circle');

// --- Subir archivos ---
drop.addEventListener('click', ()=>{
  const inp = document.createElement('input');
  inp.type = 'file';
  inp.accept = 'image/*';
  inp.multiple = true;
  inp.onchange = ()=> handleFiles(inp.files);
  inp.click();
});

drop.addEventListener('dragover', e=>{ e.preventDefault(); drop.style.borderColor='#55f';});
drop.addEventListener('dragleave', e=>{ drop.style.borderColor='#aaa';});
drop.addEventListener('drop', e=>{
  e.preventDefault();
  drop.style.borderColor='#aaa';
  handleFiles(e.dataTransfer.files);
});

function handleFiles(files){
  [...files].forEach(f=>{
    if(!f.type.startsWith('image/')) return;
    const r = new FileReader();
    r.onload = ()=> addCard(r.result, f.name);
    r.readAsDataURL(f);
  });
}

// --- Crear tarjeta ---
function addCard(src, name){
  const card = document.createElement('div');
  card.className = 'card' + (circle ? ' clip-circle' : '');

  const img = document.createElement('img');
  img.src = src;

  const dl = document.createElement('button');
  dl.className = 'download';
  dl.textContent = '⬇️';
  dl.onclick = ()=> download(card, img, name);

  card.appendChild(img);
  card.appendChild(dl);
  gal.appendChild(card);
}

// --- Cambiar radio ---
rad.addEventListener('input', ()=>{
  document.documentElement.style.setProperty('--radius', rad.value + 'px');
  document.querySelectorAll('.card:not(.clip-circle)').forEach(c=>{
    c.style.borderRadius = rad.value + 'px';
  });
});

// --- Activar círculo ---
btnCircle.addEventListener('click', ()=>{
  circle = !circle;
  btnCircle.textContent = circle ? 'Cuadrado' : 'Círculo';
  document.querySelectorAll('.card').forEach(c=>{
    if(circle){ c.classList.add('clip-circle'); c.style.borderRadius='50%'; }
    else { c.classList.remove('clip-circle'); c.style.borderRadius = rad.value + 'px'; }
  });
});

// --- Descargar ---
function download(card, img, name){
  const w = img.naturalWidth;
  const h = img.naturalHeight;
  const size = Math.min(w, h);

  const cx = document.createElement('canvas');
  cx.width = size;
  cx.height = size;
  const ctx = cx.getContext('2d');

  ctx.clearRect(0,0,size,size);
  ctx.save();

  if(circle){
    ctx.beginPath();
    ctx.arc(size/2, size/2, size/2, 0, Math.PI*2);
    ctx.closePath();
    ctx.clip();
  } else {
    const r = parseInt(getComputedStyle(card).borderRadius) || 0;
    round(ctx, 0,0,size,size, r);
    ctx.clip();
  }

  const sx = (w - size)/2;
  const sy = (h - size)/2;
  ctx.drawImage(img, sx, sy, size, size, 0, 0, size, size);
  ctx.restore();

  const a = document.createElement('a');
  a.download = name.replace(/\.[^.]+$/, '') + '.png';
  a.href = cx.toDataURL('image/png');
  a.click();
}

function round(ctx, x, y, w, h, r){
  ctx.beginPath();
  ctx.moveTo(x+r, y);
  ctx.arcTo(x+w, y, x+w, y+h, r);
  ctx.arcTo(x+w, y+h, x, y+h, r);
  ctx.arcTo(x, y+h, x, y, r);
  ctx.arcTo(x, y, x+w, y, r);
  ctx.closePath();
}

</script>
</body>
</html>
