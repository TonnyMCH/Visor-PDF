<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Venta de Frutas</title>

<link rel="icon" href="imagenes/imagen11.png" type="image/png">

<style>
body{
  font-family: Arial, sans-serif;
  background:#f2f2f2;
  margin:0;
}
.tabs{
  display:flex;
  position:sticky;
  top:0;
  background:#fff;
  z-index:10;
  box-shadow:0 2px 5px rgba(0,0,0,.1);
}
.tabs button{
  flex:1;
  padding:12px;
  border:none;
  background:#eee;
  font-size:15px;
}
.tabs button.active{
  background:#28a745;
  color:#fff;
}
.seccion{
  display:none;
  background:#fff;
  margin:10px;
  padding:15px;
  border-radius:10px;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
}
.seccion.activa{display:block}

input,select,button{
  width:100%;
  padding:10px;
  margin:5px 0;
  font-size:16px;
}
button{
  border:none;
  border-radius:6px;
}
button.green{background:#28a745;color:#fff}
button.red{background:#e53935;color:#fff}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  padding:8px;
  border-bottom:1px solid #ddd;
}
</style>
</head>

<body>

<!-- ===== MEN√ö ===== -->
<div class="tabs">
  <button class="active" onclick="abrirTab('ventaBuscar',this)">üßæ Venta</button>
  <button onclick="abrirTab('precios',this)">üçé Precios</button>
  <button onclick="abrirTab('archivos',this)">üì¶ Archivos</button>
</div>

<!-- ===== VENTA + BUSCAR ===== -->
<section id="ventaBuscar" class="seccion activa">
<h3>üîç Buscar fruta</h3>
<input id="buscarFruta" placeholder="Buscar" onkeyup="buscarFrutaFn()">

<h3>üßæ Venta</h3>
<select id="frutaVenta">
  <option value="">Seleccione fruta</option>
</select>

<input type="number" id="cantidad" placeholder="Cantidad">
<button class="green" onclick="agregarVenta()">‚ûï Agregar</button>

<table>
<thead>
<tr><th>Fruta</th><th>Cant.</th><th>Total</th><th></th></tr>
</thead>
<tbody id="lista"></tbody>
</table>

<h3>Total: ‚Ç°<span id="total">0</span></h3>
<button onclick="enviarWhatsApp()">üì≤ Enviar factura</button>
</section>

<!-- ===== PRECIOS ===== -->
<section id="precios" class="seccion">
<h3>üçé Precios</h3>

<input id="nombre" placeholder="Nombre fruta">
<input id="precio" type="number" placeholder="Precio">
<select id="tipo">
  <option value="kilo">Por kilo</option>
  <option value="unidad">Por unidad</option>
</select>

<button onclick="guardarPrecio()">üíæ Guardar</button>

<table>
<thead>
<tr><th>Fruta</th><th>Precio</th><th>Tipo</th><th></th></tr>
</thead>
<tbody id="tablaPrecios"></tbody>
</table>
</section>

<!-- ===== ARCHIVOS ===== -->
<section id="archivos" class="seccion">
<h3>üì¶ Importar / Exportar</h3>
<input type="file" accept=".json" onchange="importarJSON(event)">
<button onclick="exportarJSON()">üìÑ Exportar JSON</button>
</section>

<script>
let precios = {};
let ventas = [];
let total = 0;

/* ===== PESTA√ëAS ===== */
function abrirTab(id,btn){
  document.querySelectorAll(".seccion").forEach(s=>s.classList.remove("activa"));
  document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("active"));
  document.getElementById(id).classList.add("activa");
  btn.classList.add("active");
}

/* ===== MEMORIA ===== */
function guardarMemoria(){
  localStorage.setItem("preciosFrutas", JSON.stringify(precios));
}

/* ===== PRECIOS ===== */
function guardarPrecio(){
  if(!nombre.value || !precio.value) return alert("Datos incompletos");
  precios[nombre.value]={
    precio:Number(precio.value),
    tipo:tipo.value
  };
  nombre.value=precio.value="";
  actualizar();
}

function actualizar(){
  tablaPrecios.innerHTML="";
  frutaVenta.innerHTML=`<option value="">Seleccione fruta</option>`;

  for(let f in precios){
    tablaPrecios.innerHTML+=`
    <tr>
      <td>${f}</td>
      <td>‚Ç°${precios[f].precio}</td>
      <td>${precios[f].tipo}</td>
      <td><button class="red" onclick="eliminarPrecio('${f}')">‚ùå</button></td>
    </tr>`;
    frutaVenta.innerHTML+=`<option value="${f}">${f}</option>`;
  }
  guardarMemoria();
}

function eliminarPrecio(f){
  delete precios[f];
  actualizar();
}

/* ===== BUSCAR ===== */
function buscarFrutaFn(){
  const t=buscarFruta.value.toLowerCase();

  [...tablaPrecios.rows].forEach(r=>{
    r.style.display=r.cells[0].innerText.toLowerCase().includes(t)?"":"none";
  });

  [...frutaVenta.options].forEach((o,i)=>{
    if(i===0) return;
    o.style.display=o.text.toLowerCase().includes(t)?"":"none";
  });
}

/* ===== VENTAS ===== */
function agregarVenta(){
  if(!frutaVenta.value || !cantidad.value) return;
  const sub=cantidad.value*precios[frutaVenta.value].precio;
  ventas.push({f:frutaVenta.value,c:cantidad.value,sub});
  total+=sub;
  const i=ventas.length-1;
  lista.innerHTML+=`
  <tr data-i="${i}">
    <td>${frutaVenta.value}</td>
    <td>${cantidad.value}</td>
    <td>‚Ç°${sub}</td>
    <td><button class="red" onclick="borrarFila(${i})">‚ùå</button></td>
  </tr>`;
  document.getElementById("total").textContent=total;
  cantidad.value="";
}

function borrarFila(i){
  total-=ventas[i].sub;
  ventas[i]=null;
  document.querySelector(`tr[data-i="${i}"]`).remove();
  document.getElementById("total").textContent=total;
}

/* ===== IMPORTAR / EXPORTAR ===== */
function exportarJSON(){
  const blob=new Blob([JSON.stringify(precios,null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="precios.json";
  a.click();
}

function importarJSON(e){
  const file=e.target.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload=()=>{
    try{
      const data=JSON.parse(reader.result);

      if(Array.isArray(data)){
        data.forEach(item=>{
          if(item.nombre && item.precio){
            precios[item.nombre]={
              precio:Number(item.precio),
              tipo:item.tipo||"unidad"
            };
          }
        });
      } else {
        precios=data;
      }
      actualizar();
      alert("‚úÖ Importado y guardado");
    }catch{
      alert("‚ùå Error en el JSON");
    }
  };
  reader.readAsText(file);
}

/* ===== WHATSAPP ===== */
function enviarWhatsApp(){
  let msg="üßæ Factura%0A";
  ventas.forEach(v=>{
    if(v) msg+=`${v.f} x${v.c} = ‚Ç°${v.sub}%0A`;
  });
  msg+=`Total: ‚Ç°${total}`;
  window.open(`https://wa.me/?text=${msg}`);
}

/* ===== CARGAR MEMORIA ===== */
window.onload=()=>{
  const data=localStorage.getItem("preciosFrutas");
  if(data){
    precios=JSON.parse(data);
    actualizar();
  }
};
</script>

</body>
</html>
